---
import PostList from '@/components/PostList.astro'
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from '@/components/ui/breadcrumb'
import {
  getLangFromUrl,
  useTranslations,
  useTranslatedPath,
} from '@/i18n/utils'
import Layout from '@/layouts/Layout.astro'
import { getTags } from '@/utils/get-tags'
import { getPostsByTag } from '@/utils/get-contents'
import { defaultLang } from '@/i18n/ui'
import type { CollectionEntry } from 'astro:content'
export async function getStaticPaths() {
  const tags = await getTags(defaultLang)
  return tags.map((tag) => ({
    params: { tag: decodeURI(tag.name) },
  }))
}
type Props = CollectionEntry<'blog'>

const params = Astro.params
const lang = getLangFromUrl(Astro.url)
const posts = await getPostsByTag(params.tag!, lang)

const t = useTranslations(lang)
const translatePath = useTranslatedPath(lang)
---

<Layout title={`${t('nav.tags')}: ${params.tag}`}>
  <main class="mx-auto flex w-full max-w-3xl flex-1 flex-col px-4">
    <div class="border-grid flex h-16 items-center border-b">
      <Breadcrumb>
        <BreadcrumbList>
          <BreadcrumbItem>
            <BreadcrumbLink href={translatePath('/tags')}>
              {t('nav.tags')}
            </BreadcrumbLink>
          </BreadcrumbItem>
          <BreadcrumbSeparator />
          <BreadcrumbItem>
            <BreadcrumbPage>{params.tag}</BreadcrumbPage>
          </BreadcrumbItem>
        </BreadcrumbList>
      </Breadcrumb>
    </div>

    <PostList posts={posts} />
  </main>
</Layout>
