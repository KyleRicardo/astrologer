---
import PostList from '@/components/PostList.astro'
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from '@/components/ui/breadcrumb'
import { type Lang, useTranslations, useTranslatedPath } from '@/i18n/utils'
import Layout from '@/layouts/Layout.astro'
import { generateCategorySlugs } from '@/utils/get-categories'
import { getPostsByCategory } from '@/utils/getPosts'
import { languages, defaultLang } from '@/i18n/ui'

export async function getStaticPaths() {
  const langs = Object.keys(languages).filter((l) =>
    l !== defaultLang
  ) as Lang[]
  const paths = await Promise.all(
    langs.map(async (l) => {
      const slugs = await generateCategorySlugs(l)
      return slugs.map((slug) => ({
        params: { lang: l, slug },
      }))
    }),
  )
  return paths.flat()
}

const { lang, slug } = Astro.params as { lang: Lang; slug: string }
const posts = await getPostsByCategory(slug, lang)

const t = useTranslations(lang)
const translatePath = useTranslatedPath(lang)
---

<Layout title={`${t('nav.categories')}: ${slug}`}>
  <main class="mx-auto flex w-full max-w-3xl flex-1 flex-col px-4">
    <div class="border-grid flex h-16 items-center border-b">
      <Breadcrumb>
        <BreadcrumbList>
          <BreadcrumbItem>
            <BreadcrumbLink href={translatePath('/categories')}>
              {t('nav.categories')}
            </BreadcrumbLink>
          </BreadcrumbItem>
          <BreadcrumbSeparator />
          <BreadcrumbItem>
            <BreadcrumbPage>{slug}</BreadcrumbPage>
          </BreadcrumbItem>
        </BreadcrumbList>
      </Breadcrumb>
    </div>

    <PostList posts={posts} />
  </main>
</Layout>
