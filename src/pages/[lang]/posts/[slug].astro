---
import ArticleDetail from '@/components/ArticleDetail.astro'
import { getPostPaths } from '@/utils/get-contents'
import { languages, defaultLang } from '@/i18n/ui'
import type { Lang } from '@/i18n/utils'

export async function getStaticPaths() {
  const langs = Object.keys(languages).filter((l) =>
    l !== defaultLang
  ) as Lang[]
  const paths = await Promise.all(
    langs.map(async (lang) => {
      const postPaths = await getPostPaths(lang)
      return postPaths.map((path) => ({
        params: { ...path.params, lang },
        props: path.props,
      }))
    }),
  )
  return paths.flat()
}

const { lang } = Astro.params as { lang: Lang }
const post = Astro.props
---

<ArticleDetail post={post} lang={lang} />
