---
import PostList from "@/components/PostList.astro";
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from "@/components/ui/breadcrumb";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import Layout from "@/layouts/Layout.astro";
import { generateCategorySlugs } from "@/utils/get-categories";
import { getPostsByCategory } from "@/utils/getPosts";

export async function getStaticPaths() {
  const slugs = await generateCategorySlugs();

  return slugs.map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;
const posts = await getPostsByCategory(slug);

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout title={`${t("nav.categories")}: ${slug}`}>
  <main class="mx-auto flex w-full max-w-3xl flex-1 flex-col px-4">
    <div class="border-grid flex h-16 items-center border-b">
      <Breadcrumb>
        <BreadcrumbList>
          <BreadcrumbItem>
            <BreadcrumbLink href="/categories">
              {t("nav.categories")}
            </BreadcrumbLink>
          </BreadcrumbItem>
          <BreadcrumbSeparator />
          <BreadcrumbItem>
            <BreadcrumbPage>{slug}</BreadcrumbPage>
          </BreadcrumbItem>
        </BreadcrumbList>
      </Breadcrumb>
    </div>

    <PostList posts={posts} />
  </main>
</Layout>
