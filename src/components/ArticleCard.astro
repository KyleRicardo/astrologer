---
import { getLangFromUrl } from '@/i18n/utils';
import { getFlatCategoryInfo } from '@/utils/get-categories';
import { render, type CollectionEntry } from 'astro:content';
import coverPlaceholder from '@/assets/astro.svg';

interface Props {
  post: CollectionEntry<'blog'>
}

const { post } = Astro.props;

const { title, description, date, categories, tags } = post.data;
const { remarkPluginFrontmatter } = await render(post);

const lang = getLangFromUrl(Astro.url);
const formattedDate = date.toLocaleDateString(lang, {dateStyle: 'medium'});

const flatCategoryInfo = getFlatCategoryInfo(categories);

const displayExcerpt = description || remarkPluginFrontmatter.excerpt || ''; // Fallback chain
---

<article class="group relative flex flex-col sm:flex-row overflow-hidden rounded-xl ring-1 ring-black/5 dark:ring-white/10 transition-shadow hover:ring-black/10 dark:hover:ring-white/15">
  <!-- Cover Image -->
  <div class="relative w-full sm:w-1/4 md:w-1/3 aspect-video sm:aspect-auto overflow-hidden bg-muted shrink-0">
    <img 
      src={coverPlaceholder.src} 
      alt="" 
      class="w-full h-full object-cover transition-transform duration-300 ease-out group-hover:scale-103"
    />
  </div>
  
  <!-- Content -->
  <div class="flex flex-1 flex-col justify-center p-4 md:p-6 tracking-wide">
    <div class="flex mb-3 text-sm font-semibold text-muted-foreground overflow-hidden whitespace-nowrap">
      <time datetime={date.toISOString()}>{formattedDate}</time>
      <span class="mx-2">â€¢</span>
      {flatCategoryInfo.length > 0 && (
        <div class="inline space-x-2 z-10">
          {flatCategoryInfo.map(category => (
            <a href={category.href} class="hover:text-primary">{category.name}</a>
          ))}
        </div>
      )}
    </div>
    
    <h2 class="text-xl md:text-2xl font-semibold">
      <a href={`/posts/${post.id}`} class="before:absolute before:inset-0">
        {title}
      </a>
    </h2>
    <p class="mt-2 text-base text-muted-foreground line-clamp-2 sm:line-clamp-3">
      {displayExcerpt}
    </p>
  </div>
</article>
