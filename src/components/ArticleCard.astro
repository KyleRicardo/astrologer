---
import { getLangFromUrl } from '@/i18n/utils';
import { getFlatCategoryInfo } from '@/utils/get-categories';
import { render, type CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>
}

const { post } = Astro.props;

const { title, description, date, categories, tags } = post.data;
const { remarkPluginFrontmatter } = await render(post);

const lang = getLangFromUrl(Astro.url);
const formattedDate = date.toLocaleDateString(lang, {dateStyle: 'medium'});

const flatCategoryInfo = getFlatCategoryInfo(categories);

const displayExcerpt = description || remarkPluginFrontmatter.excerpt || ''; // Fallback chain
---

<div class="py-2 not-first:border-grid not-first:border-t">
  <div class="relative group cursor-pointer md:px-4 py-3 md:py-6 rounded-xl hover:bg-accent">
    <div class="flex flex-col tracking-wide">
      <div class="flex mb-3 text-sm font-semibold text-muted-foreground overflow-hidden whitespace-nowrap">
        <time datetime={date.toISOString()}>{formattedDate}</time>
        <span class="mx-2">â€¢</span>
        {flatCategoryInfo.length > 0 && (
          <div class="inline space-x-2 z-10">
            {flatCategoryInfo.map(category => (
              <a href={category.href} class="hover:text-primary">{category.name}</a>
            ))}
          </div>
        )}
      </div>
      
      <h2 class="text-2xl font-semibold">
        <a href={`/posts/${post.id}`} class="before:absolute before:inset-0">
          {title}
        </a>
      </h2>
      <p class="mt-2 text-base text-muted-foreground line-clamp-3">
        {displayExcerpt}
      </p>
    </div>
  </div>
</div>
