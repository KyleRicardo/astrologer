---
import { getLangFromUrl } from '@/i18n/utils';
import { getCategoryInfo } from '@/utils/get-categories';
import { render, type CollectionEntry } from 'astro:content';
import coverPlaceholder from '@/assets/astro.svg';
import { Image } from "astro:assets";

interface Props {
  post: CollectionEntry<'blog'>
}

const { post } = Astro.props;

const { cover, title, description, date, category, tags } = post.data;
const { remarkPluginFrontmatter } = await render(post);

const lang = getLangFromUrl(Astro.url);
const formattedDate = date.toLocaleDateString(lang, {dateStyle: 'medium'});

const categoryInfo = getCategoryInfo(category);

const displayExcerpt = description || remarkPluginFrontmatter.excerpt || ''; // Fallback chain
---

<article class="group relative flex flex-col sm:flex-row overflow-hidden rounded-xl ring-1 ring-black/5 dark:ring-white/10 transition-shadow hover:ring-black/10 dark:hover:ring-white/15">
  <!-- Cover Image -->
  <div class="relative w-full sm:w-1/4 md:w-1/3 aspect-video sm:aspect-auto overflow-hidden bg-muted shrink-0">
    <Image
      src={cover || coverPlaceholder} 
      alt={title} 
      class="w-full h-full object-cover transition-transform duration-300 ease-out group-hover:scale-103"
    />
  </div>
  
  <!-- Content -->
  <div class="flex flex-1 flex-col p-4 md:p-6 tracking-wide">
    <div class="flex mb-2 text-sm text-muted-foreground overflow-hidden whitespace-nowrap">
      <time datetime={date.toISOString()}>{formattedDate}</time>
      {categoryInfo && (
        <>
          <span class="mx-2">â€¢</span>
          <a href={categoryInfo.href} class="z-10 hover:text-primary">{categoryInfo.name}</a>
        </>
      )}
    </div>
    
    <h2 class="text-xl md:text-2xl font-semibold">
      <a href={`/posts/${post.id}`} class="before:absolute before:inset-0">
        {title}
      </a>
    </h2>
    <p class="mt-2 text-base text-muted-foreground line-clamp-2 md:line-clamp-3">
      {displayExcerpt}
    </p>
  </div>
</article>
